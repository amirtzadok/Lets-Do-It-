<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's Do It - Tzadok Family</title>
    <style>
        :root {
            --primary: #2563eb;
            --whatsapp: #58d368;
            --heart: #f43f5e;
            --bg: #f8fafc;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 15px; display: flex; flex-direction: column; align-items: center; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 30px; box-shadow: var(--card-shadow); width: 100%; max-width: 480px; margin-bottom: 20px; box-sizing: border-box; }
        h2 { font-size: 24px; font-weight: 800; margin-top: 0; margin-bottom: 20px; }

        .input-wrapper { position: relative; margin-bottom: 15px; width: 100%; }
        input[type="text"] { width: 100%; padding: 14px; padding-right: 40px; border-radius: 12px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; outline: none; }
        .clear-x { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: #cbd5e1; color: white; border: none; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; display: none; align-items: center; justify-content: center; font-size: 12px; }

        /* Faces UI */
        .faces-container { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .face-wrapper { cursor: pointer; text-align: center; transition: 0.3s; opacity: 0.4; }
        .face-wrapper.selected { opacity: 1; transform: translateY(-5px); }
        .face { width: 60px; height: 60px; border-radius: 50%; border: 3px solid transparent; object-fit: cover; }
        .face-wrapper.selected .face { border-color: var(--primary); }
        .heart-box { width: 60px; height: 60px; background: #fff1f2; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; border: 3px solid transparent; }
        .face-wrapper.selected .heart-box { border-color: var(--heart); }

        .primary-btn { width: 100%; padding: 18px; background: var(--whatsapp); color: white; border: none; border-radius: 20px; font-weight: 800; cursor: pointer; font-size: 18px; }

        /* Discovery & List Styles */
        .discovery-card { background: #eff6ff; border:none; }
        .suggest-card { background: white; border-radius: 20px; padding: 18px; margin-bottom: 12px; border: 1px solid #e2e8f0; }
        .suggest-info { font-size: 13px; color: #475569; margin: 6px 0; line-height: 1.4; }
        .suggest-dist { font-size: 12px; color: #94a3b8; font-weight: 600; }
        .list-item { background: #f1f5f9; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid var(--whatsapp); }

        /* Rating UI */
        .stars { display: flex; justify-content: center; gap: 10px; margin: 20px 0; font-size: 35px; color: #ddd; cursor: pointer; }
        .stars span.active { color: #facc15; }
        .star-label { text-align: center; font-weight: bold; color: var(--primary); margin-bottom: 20px; min-height: 20px; }

        .hidden { display: none !important; }
    </style>
</head>
<body onload="init()">

    <div id="rating-screen" class="card hidden">
        <h2 style="text-align:center">Rate the Idea!</h2>
        <p id="rate-idea-name" style="text-align:center; font-size:18px; font-weight:bold; color:#334155;"></p>
        <div class="stars" id="star-row">
            <span onclick="setStars(1)">‚òÖ</span><span onclick="setStars(2)">‚òÖ</span><span onclick="setStars(3)">‚òÖ</span><span onclick="setStars(4)">‚òÖ</span><span onclick="setStars(5)">‚òÖ</span>
        </div>
        <div id="star-desc" class="star-label">Choose your rating</div>
        <button class="primary-btn" onclick="submitRating()">Submit My Vote</button>
    </div>

    <div id="main-app">
        <div class="card">
            <h2>New Activity</h2>
            <div class="input-wrapper">
                <input type="text" id="main-input" placeholder="What's the plan?" oninput="toggleX('main-input', 'main-clear')">
                <button id="main-clear" class="clear-x" onclick="clearField('main-input', 'main-clear')">‚úï</button>
            </div>

            <div class="faces-container">
                <div class="face-wrapper" id="f-all" onclick="selectAll()">
                    <div class="heart-box">‚ù§Ô∏è</div>
                    <p style="font-size:10px; margin-top:5px; font-weight:bold; color:var(--heart);">Everyone</p>
                </div>
                <div id="faces-render" style="display:flex; gap:10px;"></div>
            </div>
            <button class="primary-btn" onclick="sendWA()">Add & Invite Tzadok Family</button>
        </div>

        <div class="card">
            <h2>üöÄ Let's Do It! List</h2>
            <div id="final-list"></div>
        </div>

        <div class="card discovery-card">
            <h3 style="margin-top:0;">üîç Discover Activities</h3>
            <div class="input-wrapper">
                <input type="text" id="search-input" placeholder="Search (e.g. Pool, Zoo, Hike)..." oninput="toggleX('search-input', 'search-clear'); runSearch()">
                <button id="search-clear" class="clear-x" onclick="clearField('search-input', 'search-clear'); setCat('outdoor')">‚úï</button>
            </div>
            <div id="results-list"></div>
        </div>
    </div>

    <script>
        const family = [{ id: 1, name: "Amir", img: "amir.png" }, { id: 2, name: "Rani", img: "rani.png" }, { id: 3, name: "Lia", img: "lia.png" }, { id: 4, name: "Gal", img: "gal.png" }];
        const db = [{ n: "Alexander Stream Hike", cat: "outdoor", d: "12m", info: "A beautiful trail with turtles.", tags: ["hike"] }, { n: "Michmoret Beach", cat: "outdoor", d: "20m", info: "Clean sandy beach.", tags: ["beach", "swimming"] }, { n: "Local Swimming Pool", cat: "outdoor", d: "5m", info: "Cool off in the pool.", tags: ["pool", "swimming"] }];

        let selected = [];
        let currentRating = 0;
        let activities = JSON.parse(localStorage.getItem('tzadok_final_list')) || [];

        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const rateName = urlParams.get('rate');

            if (rateName) {
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('rating-screen').classList.remove('hidden');
                document.getElementById('rate-idea-name').innerText = `"${rateName}"`;
            }

            document.getElementById('faces-render').innerHTML = family.map(f => `
                <div class="face-wrapper" id="f-${f.id}" onclick="toggleFace(${f.id})">
                    <img src="${f.img}" class="face" onerror="this.src='https://via.placeholder.com/60'">
                    <p style="font-size:10px; margin-top:5px; font-weight:bold;">${f.name}</p>
                </div>
            `).join('');
            renderFinalList();
        }

        // --- RATING LOGIC ---
        const starLabels = { 1: "No thanks", 2: "Probably not", 3: "Maybe", 4: "I like it!", 5: "LET'S DO IT!" };
        function setStars(n) {
            currentRating = n;
            const stars = document.querySelectorAll('#star-row span');
            stars.forEach((s, i) => s.classList.toggle('active', i < n));
            document.getElementById('star-desc').innerText = starLabels[n];
        }

        function submitRating() {
            if (currentRating === 0) return alert("Please pick a star!");
            const idea = new URLSearchParams(window.location.search).get('rate');

            if (currentRating >= 4) {
                activities.push({ title: idea, date: new Date().toLocaleDateString() });
                localStorage.setItem('tzadok_final_list', JSON.stringify(activities));
                alert("Added to the Let's Do It list!");
            }
            window.location.href = window.location.pathname; // Go back to main app
        }

        // --- MAIN UI LOGIC ---
        function toggleX(inp, btn) { document.getElementById(btn).style.display = document.getElementById(inp).value ? 'flex' : 'none'; }
        function clearField(inp, btn) { document.getElementById(inp).value = ''; toggleX(inp, btn); }
        function toggleFace(id) { const i = selected.indexOf(id); i > -1 ? selected.splice(i, 1) : selected.push(id); updateUI(); }
        function selectAll() { selected = (selected.length === family.length) ? [] : family.map(f => f.id); updateUI(); }
        function updateUI() {
            family.forEach(f => document.getElementById(`f-${f.id}`).classList.toggle('selected', selected.includes(f.id)));
            document.getElementById('f-all').classList.toggle('selected', selected.length === family.length);
        }

        function renderFinalList() {
            document.getElementById('final-list').innerHTML = activities.map(a => `
                <div class="list-item"><strong>${a.title}</strong><br><small>Added ${a.date}</small></div>
            `).join('') || '<p style="font-size:12px; color:#94a3b8;">No 4-5 star ideas yet.</p>';
        }

        function sendWA() {
            const val = document.getElementById('main-input').value;
            if(!val || selected.length === 0) return alert("Pick an idea and participants!");
            
            const baseUrl = window.location.href.split('?')[0]; // Current URL without parameters
            const ratingUrl = `${baseUrl}?rate=${encodeURIComponent(val)}`;
            const names = family.filter(f => selected.includes(f.id)).map(f => f.name);
            
            const msg = `Tzadok Family! Amir suggests: "${val}" for ${names.join(", ")}. Rate it here: ${ratingUrl}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function runSearch() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const list = db.filter(a => a.n.toLowerCase().includes(q) || a.tags.some(t => t.includes(q)));
            document.getElementById('results-list').innerHTML = list.map(item => `
                <div class="suggest-card">
                    <button style="float:right" onclick="document.getElementById('main-input').value='${item.n}';toggleX('main-input','main-clear')">Use</button>
                    <strong>${item.n}</strong><p class="suggest-info">${item.info}</p>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
