<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's Do It!</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    
    <style>
        :root {
            --primary: #2563eb;
            --whatsapp: #76ce71;
            --bg: #f8fafc;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --card-max-width: 480px;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #ffffff; 
            margin: 0; 
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Setup Screen Centering */
        #setup-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        .logo-img {
            width: 80px;
            margin-bottom: 20px;
        }

        .setup-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 30px;
            color: #000;
        }

        /* Avatar Selection - Vertical Mobile */
        .avatar-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 40px;
        }

        .avatar-choice {
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            padding: 10px;
            border-radius: 20px;
            transition: 0.2s;
        }

        .avatar-btn {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            border: 4px solid transparent;
            object-fit: cover;
        }

        .avatar-choice.active .avatar-btn {
            border-color: var(--whatsapp);
            transform: scale(1.05);
        }

        .avatar-choice span {
            font-size: 22px;
            font-weight: bold;
            color: #333;
        }

        /* Desktop Layout */
        @media (min-width: 768px) {
            .avatar-options {
                flex-direction: row;
                max-width: 800px;
                flex-wrap: wrap;
                justify-content: center;
                gap: 40px;
            }
            .avatar-choice {
                flex-direction: column;
                text-align: center;
            }
            .avatar-btn {
                width: 120px;
                height: 120px;
            }
        }

        .primary-btn {
            width: 100%;
            max-width: 300px;
            padding: 16px;
            background: var(--whatsapp);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
        }

        .primary-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .app-header {
            display: flex; align-items: center; justify-content: center;
            width: 100%; max-width: 480px; padding: 15px 0; position: relative;
        }
        .app-header h1 { font-size: 24px; font-weight: 900; color: var(--primary); margin: 0; }
        .header-btn {
            background: white; border: 1px solid var(--primary); color: var(--primary); padding: 5px 10px;
            border-radius: 15px; font-size: 12px; font-weight: bold; cursor: pointer; position: absolute;
            top: 50%; transform: translateY(-50%);
        }
        .main-card { background: white; padding: 20px; border-radius: 30px; box-shadow: var(--card-shadow); width: 100%; max-width: 480px; margin-bottom: 20px; }
        .hidden { display: none !important; }
        
        .face-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; margin: 15px 0; }
        .face-wrapper { cursor: pointer; text-align: center; opacity: 0.4; display: flex; flex-direction: column; align-items: center; }
        .face-wrapper.selected { opacity: 1; }
        .face-img { width: 45px; height: 45px; border-radius: 50%; border: 3px solid transparent; object-fit: cover; }
        .face-wrapper.selected .face-img { border-color: var(--primary); }
    </style>
</head>
<body onload="init()">

    <div id="setup-card" class="hidden">
        <img src="logo.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
        <h2 class="setup-title" data-i18n="whoAreYou">Choose your avatar</h2>
        <div class="avatar-options" id="avatar-selector"></div>
        <button class="primary-btn" id="start-btn" onclick="finishSetup()" disabled data-i18n="enterApp">Let's do it!</button>
    </div>

    <div id="main-content" class="hidden">
        <header class="app-header">
            <h1 id="app-name-display"> Let's Do It!</h1>
            <button id="lang-toggle" class="header-btn" onclick="toggleLanguage()"></button>
        </header>

        <div class="main-card">
            <div id="user-info" style="display:flex; align-items:center; gap:10px; margin-bottom:15px;"></div>
            <h2 data-i18n="doSomething">let's do something together!</h2>
            <input type="text" id="main-input" data-i18n-placeholder="planPlaceholder" oninput="updateUIState()" style="width:100%; padding:12px; border-radius:12px; border:1px solid #ddd;">
            
            <div class="face-grid">
                <div id="faces-render" style="display:contents;"></div>
            </div>
            <button class="primary-btn" id="action-btn" onclick="sendWA()" disabled data-i18n="selectParticipants" style="max-width:100%"></button>
        </div>
        
        <div class="main-card">
            <h2 data-i18n="futureActivities"> Future Activities!</h2>
            <div id="final-list"></div>
        </div>
    </div>

    <script>
        const i18n = {
            eng: {
                langBtn: "HEB", whoAreYou: "Choose your avatar", enterApp: "Let's do it!",
                hiUser: "Hi", doSomething: "Let's do something together!", planPlaceholder: "What's the plan?",
                futureActivities: " Future Activities!", selectParticipants: "Select Participants", invitePrefix: "Invite"
            },
            heb: {
                langBtn: "ENG", whoAreYou: "专  转/", enterApp: " 转!",
                hiUser: "", doSomething: " 注砖 砖 !", planPlaceholder: " 转?",
                futureActivities: " 驻注转 注转转!", selectParticipants: "专 砖转转驻", invitePrefix: " 转"
            }
        };

        const family = [
            { id: 1, name: "Amir", img: "amir.png" },
            { id: 2, name: "Rani", img: "rani.png" },
            { id: 3, name: "Lia", img: "lia.png" },
            { id: 4, name: "Gal", img: "gal.png" }
        ];

        let currentLang = localStorage.getItem('letsdoit_lang') || 'eng';
        let currentUser = JSON.parse(localStorage.getItem('letsdoit_user_identity'));
        let selected = [];

        function toggleLanguage() { 
            currentLang = currentLang === 'eng' ? 'heb' : 'eng'; 
            localStorage.setItem('letsdoit_lang', currentLang); 
            location.reload(); 
        }

        function init() {
            document.body.dir = currentLang === 'heb' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => el.innerText = i18n[currentLang][el.getAttribute('data-i18n')]);
            
            const langBtn = document.getElementById('lang-toggle');
            if(langBtn) {
                langBtn.innerText = i18n[currentLang].langBtn;
                langBtn.style[currentLang === 'heb' ? 'left' : 'right'] = '10px';
            }

            if (!currentUser) {
                document.getElementById('setup-card').classList.remove('hidden');
                renderSetup();
            } else {
                showMainApp();
            }
        }

        function renderSetup() {
            document.getElementById('avatar-selector').innerHTML = family.map(f => `
                <div class="avatar-choice" id="choice-${f.id}" onclick="selectSelf(${f.id})">
                    <img src="${f.img}" class="avatar-btn" onerror="this.src='https://via.placeholder.com/120'">
                    <span>${f.name}</span>
                </div>
            `).join('');
        }

        function selectSelf(id) {
            document.querySelectorAll('.avatar-choice').forEach(el => el.classList.remove('active'));
            document.getElementById(`choice-${id}`).classList.add('active');
            document.getElementById('start-btn').disabled = false;
            window.tempId = id;
        }

        function finishSetup() {
            currentUser = family.find(f => f.id === window.tempId);
            localStorage.setItem('letsdoit_user_identity', JSON.stringify(currentUser));
            location.reload();
        }

        function showMainApp() {
            document.getElementById('main-content').classList.remove('hidden');
            const welcomeText = currentLang === 'heb' ? `, ${currentUser.name}` : `Hi, ${currentUser.name}`;
            document.getElementById('user-info').innerHTML = `<img src="${currentUser.img}" style="width:40px;height:40px;border-radius:50%"> <b>${welcomeText}</b>`;
            document.getElementById('faces-render').innerHTML = family.map(f => `
                <div class="face-wrapper" id="f-${f.id}" onclick="toggleFace(${f.id})">
                    <img src="${f.img}" class="face-img" onerror="this.src='https://via.placeholder.com/50'">
                    <p style="font-size:10px; font-weight:bold;">${f.name}</p>
                </div>
            `).join('');
        }

        function toggleFace(id) {
            const idx = selected.indexOf(id);
            idx > -1 ? selected.splice(idx, 1) : selected.push(id);
            updateUIState();
        }

        function updateUIState() {
            const val = document.getElementById('main-input').value;
            family.forEach(f => {
                const face = document.getElementById(`f-${f.id}`);
                if (face) face.classList.toggle('selected', selected.includes(f.id));
            });
            const btn = document.getElementById('action-btn');
            if (btn) {
                btn.disabled = !(selected.length > 0 && val);
                if (selected.length > 0) {
                    const names = family.filter(f => selected.includes(f.id)).map(f => f.name).join(' & ');
                    btn.innerText = `${i18n[currentLang].invitePrefix} ${names}`;
                } else {
                    btn.innerText = i18n[currentLang].selectParticipants;
                }
            }
        }

        function sendWA() {
            alert("Sending Invite...");
        }
    </script>
</body>
</html>
