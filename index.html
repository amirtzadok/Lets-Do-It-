<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Let's Do It!</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    
    <style>
        :root {
            --primary: #2563eb;
            --whatsapp: #76ce71;
            --bg: #f8fafc;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --card-max-width: 480px;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #ffffff; 
            margin: 0; 
            height: 100vh; 
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden; 
            position: fixed;
        }

        .lang-btn {
            position: absolute;
            top: 15px;
            background: white;
            border: 1px solid #ddd;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
        }

        /* Setup Screen */
        #setup-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100%;
            padding: 20px;
            text-align: center;
            touch-action: none;
        }

        .logo-img {
            width: 160px;
            height: auto;
            margin-bottom: 15px; 
        }

        .setup-title {
            font-size: 24px;
            font-weight: 800;
            margin: 0 0 20px 0;
            color: #000;
        }

        .avatar-options {
            display: flex;
            flex-direction: column;
            gap: 12px; 
            width: 100%;
            max-width: 280px;
            margin-bottom: 25px;
        }

        .avatar-choice {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 4px;
            border-radius: 15px;
            transition: 0.2s;
        }

        .avatar-btn {
            width: 75px; 
            height: 75px;
            border-radius: 50%;
            border: 4px solid transparent;
            object-fit: cover;
            margin-bottom: 4px;
        }

        .avatar-choice.active .avatar-btn {
            border-color: var(--whatsapp);
            transform: scale(1.05);
        }

        .avatar-choice span {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        @media (min-width: 768px) {
            body { overflow: auto; position: static; }
            .logo-img { width: 180px; margin-bottom: 60px; }
            .setup-title { font-size: 36px; margin-bottom: 50px; }
            .avatar-options {
                flex-direction: row;
                max-width: 900px;
                flex-wrap: wrap;
                justify-content: center;
                gap: 60px;
                margin-bottom: 70px;
            }
            .avatar-btn { width: 130px; height: 130px; }
            .avatar-choice span { font-size: 22px; }
            .primary-btn { max-width: 320px; padding: 20px; font-size: 20px; }
        }

        .primary-btn {
            width: 100%;
            max-width: 260px;
            padding: 14px;
            background: var(--whatsapp);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            font-size: 18px;
        }

        .primary-btn:disabled {
            opacity: 0.6;
        }

        /* Main Screen */
        #main-content { 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            overflow-y: auto; 
            height: 100vh; 
        }

        .main-card { 
            background: white; 
            padding: 20px; 
            border-radius: 30px; 
            box-shadow: var(--card-shadow); 
            width: 100%; 
            max-width: var(--card-max-width); 
            margin-bottom: 20px; 
        }

        .hidden { display: none !important; }
        
        .face-grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 10px; 
            width: 100%; 
            margin: 15px 0; 
        }

        .face-wrapper { 
            cursor: pointer; 
            text-align: center; 
            opacity: 0.4; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }

        .face-wrapper.selected { opacity: 1; }

        .face-img { 
            width: 45px; 
            height: 45px; 
            border-radius: 50%; 
            border: 3px solid transparent; 
            object-fit: cover; 
        }

        .face-wrapper.selected .face-img { border-color: var(--primary); }
        .heart-box { width: 45px; height: 45px; background: #fff1f2; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; border: 3px solid transparent; }
        .face-wrapper.selected .heart-box { border-color: var(--primary); }
    </style>
</head>
<body onload="init()">

    <button id="lang-toggle" class="lang-btn" onclick="toggleLanguage()">HEB</button>

    <div id="setup-card" class="hidden">
        <img src="logo.png" alt="Logo" class="logo-img" onerror="this.src='https://via.placeholder.com/160?text=Logo'">
        <h2 class="setup-title" data-i18n="whoAreYou">Choose your avatar</h2>
        <div class="avatar-options" id="avatar-selector"></div>
        <button class="primary-btn" id="start-btn" onclick="finishSetup()" disabled data-i18n="enterApp">Let's do it!</button>
    </div>

    <div id="main-content" class="hidden">
        <div class="main-card">
            <div id="user-info" style="display:flex; align-items:center; gap:10px; margin-bottom:15px;"></div>
            <h2 data-i18n="doSomething">let's do something together!</h2>
            <input type="text" id="main-input" data-i18n-placeholder="planPlaceholder" oninput="updateUIState()" style="width:100%; padding:12px; border-radius:12px; border:1px solid #ddd;">
            <div class="face-grid">
                <div id="faces-render" style="display:contents;"></div>
                <div class="face-wrapper" id="f-all" onclick="selectAll()">
                    <div class="heart-box">わ</div>
                    <p style="font-size:10px; font-weight:bold;" data-i18n="everyone">Everyone</p>
                </div>
            </div>
            <button class="primary-btn" id="action-btn" onclick="sendWA()" disabled data-i18n="selectParticipants" style="max-width:100%"></button>
        </div>
    </div>

    <script>
        const i18n = {
            eng: {
                whoAreYou: "Choose your avatar", enterApp: "Let's do it!",
                hiUser: "Hi", doSomething: "Let's do something together!", planPlaceholder: "What's the plan?",
                selectParticipants: "Select Participants", invitePrefix: "Invite", langBtn: "HEB",
                waMsg: "suggested: ", everyone: "Everyone"
            },
            heb: {
                whoAreYou: "专  转/", enterApp: " 转!",
                hiUser: "", doSomething: " 注砖 砖 !", planPlaceholder: " 转?",
                selectParticipants: "专 砖转转驻", invitePrefix: " 转", langBtn: "ENG",
                waMsg: "爪注/: ", everyone: ""
            }
        };

        const family = [
            { id: 1, name: "Amir", img: "amir.png", phone: "972547880404" },
            { id: 2, name: "Rani", img: "rani.png", phone: "972542428664" },
            { id: 3, name: "Lia", img: "lia.png", phone: "972526765297" },
            { id: 4, name: "Gal", img: "gal.png", phone: "972553054450" }
        ];

        let currentLang = localStorage.getItem('letsdoit_lang') || 'eng';
        let currentUser = JSON.parse(localStorage.getItem('letsdoit_user_identity'));
        let selected = [];

        function toggleLanguage() {
            currentLang = currentLang === 'eng' ? 'heb' : 'eng';
            localStorage.setItem('letsdoit_lang', currentLang);
            location.reload();
        }

        function init() {
            document.body.dir = currentLang === 'heb' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => el.innerText = i18n[currentLang][el.getAttribute('data-i18n')]);
            
            const lBtn = document.getElementById('lang-toggle');
            lBtn.innerText = i18n[currentLang].langBtn;
            lBtn.style[currentLang === 'heb' ? 'left' : 'right'] = '15px';

            if (!currentUser) {
                document.getElementById('setup-card').classList.remove('hidden');
                renderSetup();
            } else {
                document.body.style.overflow = "auto";
                document.body.style.position = "static";
                showMainApp();
            }
        }

        function renderSetup() {
            document.getElementById('avatar-selector').innerHTML = family.map(f => `
                <div class="avatar-choice" id="choice-${f.id}" onclick="selectSelf(${f.id})">
                    <img src="${f.img}" class="avatar-btn" onerror="this.src='https://via.placeholder.com/120'">
                    <span>${f.name}</span>
                </div>
            `).join('');
        }

        function selectSelf(id) {
            document.querySelectorAll('.avatar-choice').forEach(el => el.classList.remove('active'));
            document.getElementById(`choice-${id}`).classList.add('active');
            document.getElementById('start-btn').disabled = false;
            window.tempId = id;
        }

        function finishSetup() {
            currentUser = family.find(f => f.id === window.tempId);
            localStorage.setItem('letsdoit_user_identity', JSON.stringify(currentUser));
            location.reload();
        }

        function showMainApp() {
            document.getElementById('main-content').classList.remove('hidden');
            const welcomeMsg = currentLang === 'heb' ? `, ${currentUser.name}` : `Hi, ${currentUser.name}`;
            document.getElementById('user-info').innerHTML = `<img src="${currentUser.img}" style="width:40px;height:40px;border-radius:50%"> <b>${welcomeMsg}</b>`;
            document.getElementById('faces-render').innerHTML = family.map(f => `
                <div class="face-wrapper" id="f-${f.id}" onclick="toggleFace(${f.id})">
                    <img src="${f.img}" class="face-img" onerror="this.src='https://via.placeholder.com/50'">
                    <p style="font-size:10px; font-weight:bold;">${f.name}</p>
                </div>
            `).join('');
        }

        function toggleFace(id) {
            const idx = selected.indexOf(id);
            idx > -1 ? selected.splice(idx, 1) : selected.push(id);
            updateUIState();
        }

        function selectAll() {
            selected = (selected.length === family.length) ? [] : family.map(f => f.id);
            updateUIState();
        }

        function updateUIState() {
            const val = document.getElementById('main-input').value;
            family.forEach(f => {
                const el = document.getElementById(`f-${f.id}`);
                if (el) el.classList.toggle('selected', selected.includes(f.id));
            });
            document.getElementById('f-all').classList.toggle('selected', selected.length === family.length);
            
            const btn = document.getElementById('action-btn');
            if (btn) {
                btn.disabled = !(selected.length > 0 && val);
                if (selected.length > 0) {
                    const names = selected.length === family.length ? i18n[currentLang].everyone : family.filter(f => selected.includes(f.id)).map(f => f.name).join(' & ');
                    btn.innerText = `${i18n[currentLang].invitePrefix} ${names}`;
                } else {
                    btn.innerText = i18n[currentLang].selectParticipants;
                }
            }
        }

        function sendWA() {
            const plan = document.getElementById('main-input').value;
            const message = ` ${currentUser.name} ${i18n[currentLang].waMsg}${plan}`;
            
            if (selected.length === family.length) {
                // Targeted group logic
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            } else if (selected.length === 1) {
                const target = family.find(f => f.id === selected[0]);
                window.open(`https://wa.me/${target.phone}?text=${encodeURIComponent(message)}`, '_blank');
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            }
        }
    </script>
</body>
</html>
