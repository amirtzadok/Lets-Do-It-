<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's Do It!</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">

    <style>
        :root {
            --primary: #2563eb;
            --whatsapp: #76ce71; /* Matched to green in image */
            --heart: #f43f5e;
            --bg: #f8fafc;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --card-max-width: 480px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff; /* Matching white background from image */
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            margin: 0;
            min-height: 100vh;
        }

        .app-header {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: var(--card-max-width);
            padding: 15px 0;
            position: relative;
        }

        .app-header h1 {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary);
            margin: 0;
        }

        .header-btn {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            min-width: 50px;
            text-align: center;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 30px;
            width: 100%;
            max-width: var(--card-max-width);
            margin-bottom: 20px;
        }

        /* Setup Screen / Avatar Selector specific to image reference */
        .setup-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            padding: 40px 20px;
        }

        .setup-rocket {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .setup-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 40px;
            color: #000;
        }

        .avatar-list {
            display: flex;
            flex-direction: column;
            gap: 25px;
            width: 100%;
            margin-bottom: 40px;
        }

        .avatar-row {
            display: flex;
            align-items: center;
            gap: 30px;
            cursor: pointer;
            padding: 10px;
            border-radius: 20px;
            transition: background 0.2s;
        }

        .avatar-row:active {
            background: #f0f0f0;
        }

        .avatar-row.active .avatar-img {
            border: 4px solid var(--whatsapp);
        }

        .avatar-img {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid transparent;
        }

        .avatar-label {
            font-size: 26px;
            font-weight: 700;
            color: #000;
        }

        /* Main App Grid (Post-Setup) */
        .face-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            width: 100%;
            justify-items: center;
        }

        .face-wrapper {
            cursor: pointer;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .face-img-small {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid transparent;
            object-fit: cover;
        }

        .face-wrapper.selected .face-img-small {
            border-color: #ef4444;
        }

        /* Buttons */
        .primary-btn {
            width: 100%;
            min-height: 55px;
            background: var(--whatsapp);
            color: white;
            border: none;
            border-radius: 30px; /* Rounder as per image */
            font-weight: 700;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .primary-btn:disabled {
            opacity: 0.6;
        }

        .secondary-btn {
            width: 100%;
            min-height: 45px;
            background: #cbd5e1;
            color: white;
            border: none;
            border-radius: 15px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Logistics and List items */
        .logistics-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .logistics-label { font-size: 13px; color: #64748b; width: 100px; flex-shrink: 0; font-weight: bold; }
        .list-item { background: #f1f5f9; padding: 15px; border-radius: 20px; margin-bottom: 12px; border-left: 5px solid var(--whatsapp); position: relative; }
        body[dir="rtl"] .list-item { border-left: none; border-right: 5px solid var(--whatsapp); }

        .hidden { display: none !important; }

        @media (min-width: 768px) {
            .avatar-row { justify-content: center; }
        }
    </style>
</head>

<body onload="init()">

    <div id="setup-screen" class="setup-container hidden">
        <div class="setup-rocket"></div>
        <h2 class="setup-title" data-i18n="whoAreYou">Choose your avatar</h2>
        <div class="avatar-list" id="avatar-selector"></div>
        <button class="primary-btn" id="start-btn" onclick="finishSetup()" disabled data-i18n="enterApp">Let's do it!</button>
    </div>

    <div id="main-app" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <header class="app-header">
            <h1 id="app-name-display"> Let's Do It!</h1>
            <button id="lang-toggle" class="header-btn" onclick="toggleLanguage()"></button>
        </header>

        <div class="card">
            <div id="user-info" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;"></div>
            <h2 data-i18n="doSomething">let's do something together!</h2>
            <input type="text" id="main-input" data-i18n-placeholder="planPlaceholder" oninput="updateUIState()">
            
            <div class="face-grid" style="margin: 20px 0;">
                <div id="faces-render" style="display:contents;"></div>
            </div>
            <button class="primary-btn" id="action-btn" onclick="sendWA()" disabled data-i18n="selectParticipants"></button>
        </div>

        <div class="card">
            <h2 data-i18n="futureActivities"> Future Activities!</h2>
            <div id="final-list"></div>
        </div>
    </div>

    <script>
        const i18n = {
            eng: { 
                whoAreYou: "Choose your avatar", enterApp: "Let's do it!", 
                hiUser: "Hi", doSomething: "Let's do something together!", 
                planPlaceholder: "What's the plan?", selectParticipants: "Select Participants",
                langBtn: "HEB", futureActivities: " Future Activities!", invitePrefix: "Invite"
            },
            heb: { 
                whoAreYou: "专 转 专 砖", enterApp: " 转!", 
                hiUser: "", doSomething: " 注砖 砖 !", 
                planPlaceholder: " 转?", selectParticipants: "专 砖转转驻",
                langBtn: "ENG", futureActivities: " 驻注转 注转转!", invitePrefix: " 转"
            }
        };

        const family = [
            { id: 1, name: "Amir", phone: "972547880404", img: "amir.png" },
            { id: 2, name: "Rani", phone: "972542428664", img: "rani.png" },
            { id: 3, name: "Lia", phone: "972526765297", img: "lia.png" },
            { id: 4, name: "Gal", phone: "972553054450", img: "gal.png" }
        ];

        let currentLang = localStorage.getItem('letsdoit_lang') || 'eng';
        let currentUser = JSON.parse(localStorage.getItem('letsdoit_user_identity'));
        let selected = [];

        function init() {
            updateUILanguage();
            if (!currentUser) {
                document.getElementById('setup-screen').classList.remove('hidden');
                renderSetup();
            } else {
                showMainApp();
            }
        }

        function toggleLanguage() {
            currentLang = currentLang === 'eng' ? 'heb' : 'eng';
            localStorage.setItem('letsdoit_lang', currentLang);
            location.reload();
        }

        function updateUILanguage() {
            const d = i18n[currentLang];
            document.body.dir = currentLang === 'heb' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => el.innerText = d[el.getAttribute('data-i18n')]);
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => el.placeholder = d[el.getAttribute('data-i18n-placeholder')]);
            const btn = document.getElementById('lang-toggle');
            if (btn) btn.innerText = d.langBtn;
        }

        function renderSetup() {
            document.getElementById('avatar-selector').innerHTML = family.map(f => `
                <div class="avatar-row" id="choice-${f.id}" onclick="selectSelf(${f.id})">
                    <img src="${f.img}" class="avatar-img" onerror="this.src='https://via.placeholder.com/90'">
                    <span class="avatar-label">${f.name}</span>
                </div>
            `).join('');
        }

        function selectSelf(id) {
            document.querySelectorAll('.avatar-row').forEach(el => el.classList.remove('active'));
            document.getElementById(`choice-${id}`).classList.add('active');
            document.getElementById('start-btn').disabled = false;
            window.tempId = id;
        }

        function finishSetup() {
            currentUser = family.find(f => f.id === window.tempId);
            localStorage.setItem('letsdoit_user_identity', JSON.stringify(currentUser));
            location.reload();
        }

        function showMainApp() {
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('user-info').innerHTML = `<img src="${currentUser.img}" style="width:40px;height:40px;border-radius:50%"> <b>${i18n[currentLang].hiUser}, ${currentUser.name}</b>`;
            document.getElementById('faces-render').innerHTML = family.map(f => `
                <div class="face-wrapper" id="f-${f.id}" onclick="toggleFace(${f.id})">
                    <img src="${f.img}" class="face-img-small" onerror="this.src='https://via.placeholder.com/45'">
                    <p style="font-size:10px; font-weight:bold; margin-top:5px;">${f.name}</p>
                </div>
            `).join('');
        }

        function toggleFace(id) {
            const idx = selected.indexOf(id);
            idx > -1 ? selected.splice(idx, 1) : selected.push(id);
            updateUIState();
        }

        function updateUIState() {
            const val = document.getElementById('main-input').value;
            family.forEach(f => {
                const el = document.getElementById(`f-${f.id}`);
                if (el) el.classList.toggle('selected', selected.includes(f.id));
            });
            const btn = document.getElementById('action-btn');
            btn.disabled = !(selected.length > 0 && val);
            if (selected.length > 0) {
                const names = family.filter(f => selected.includes(f.id)).map(f => f.name).join(' & ');
                btn.innerText = `${i18n[currentLang].invitePrefix} ${names}`;
            } else {
                btn.innerText = i18n[currentLang].selectParticipants;
            }
        }

        function sendWA() {
            const title = document.getElementById('main-input').value;
            window.open(`https://wa.me/?text=${encodeURIComponent(' ' + currentUser.name + ' suggested: ' + title)}`, '_blank');
        }
    </script>
</body>

</html>
